<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GrowGTPS - Admin Panel</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    min-height: 100vh;
    color: #333;
    line-height: 1.6;
  }

  .login-screen {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }

  .login-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.2);
    width: 100%;
    max-width: 400px;
    text-align: center;
  }

  .login-header {
    margin-bottom: 30px;
  }

  .login-header h1 {
    font-size: 2rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 10px;
  }

  .login-header p {
    color: #6b7280;
    font-size: 1rem;
  }

  .form-group {
    margin-bottom: 20px;
    text-align: left;
  }

  .form-group label {
    display: block;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
    font-size: 0.95rem;
  }

  .form-group input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.8);
  }

  .form-group input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    background: white;
  }

  .login-btn {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    border: none;
    color: white;
    font-weight: 600;
    cursor: pointer;
    border-radius: 12px;
    padding: 16px 24px;
    font-size: 1.1rem;
    width: 100%;
    margin-top: 20px;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
  }

  .admin-panel {
    display: none;
    min-height: 100vh;
  }

  .admin-header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .admin-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
  }

  .logout-btn {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .logout-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
  }

  .admin-content {
    padding: 30px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border-left: 4px solid;
    transition: transform 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-3px);
  }

  .stat-card.pending {
    border-left-color: #f59e0b;
  }

  .stat-card.completed {
    border-left-color: #10b981;
  }

  .stat-card.total {
    border-left-color: #3b82f6;
  }

  .stat-card.revenue {
    border-left-color: #8b5cf6;
  }

  .stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 5px;
  }

  .stat-label {
    color: #6b7280;
    font-size: 0.9rem;
    font-weight: 500;
  }

  .orders-section {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
  }

  .section-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #1f2937;
  }

  .refresh-btn {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .refresh-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
  }

  .filters {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .filter-select {
    padding: 8px 12px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.9rem;
    background: white;
    cursor: pointer;
  }

  .filter-select:focus {
    outline: none;
    border-color: #3b82f6;
  }

  .orders-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }

  .orders-table th,
  .orders-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
  }

  .orders-table th {
    background: #f8fafc;
    font-weight: 600;
    color: #374151;
    font-size: 0.9rem;
  }

  .orders-table td {
    font-size: 0.85rem;
  }

  .order-id {
    font-family: monospace;
    font-weight: 600;
    color: #3b82f6;
  }

  .status-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-align: center;
    min-width: 100px;
    display: inline-block;
  }

  .status-pending {
    background: #fef3c7;
    color: #92400e;
  }

  .status-processing {
    background: #dbeafe;
    color: #1e40af;
  }

  .status-completed {
    background: #d1fae5;
    color: #065f46;
  }

  .status-cancelled {
    background: #fee2e2;
    color: #991b1b;
  }

  .action-buttons {
    display: flex;
    gap: 5px;
  }

  .action-btn {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-view {
    background: #3b82f6;
    color: white;
  }

  .btn-edit {
    background: #f59e0b;
    color: white;
  }

  .btn-complete {
    background: #10b981;
    color: white;
  }

  .btn-cancel {
    background: #ef4444;
    color: white;
  }

  .action-btn:hover {
    transform: translateY(-1px);
    opacity: 0.9;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
  }

  .modal-content {
    background: white;
    margin: 5% auto;
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    position: relative;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e5e7eb;
  }

  .modal-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #1f2937;
  }

  .close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    border: none;
    background: none;
  }

  .close:hover {
    color: #000;
  }

  .order-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
  }

  .detail-item {
    background: #f8fafc;
    padding: 12px;
    border-radius: 8px;
    border-left: 3px solid #3b82f6;
  }

  .detail-label {
    font-size: 0.8rem;
    color: #6b7280;
    font-weight: 500;
    margin-bottom: 3px;
  }

  .detail-value {
    font-weight: 600;
    color: #1f2937;
    font-size: 0.9rem;
  }

  .status-update {
    margin-top: 20px;
  }

  .status-select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    font-size: 1rem;
    margin-bottom: 15px;
  }

  .update-btn {
    background: linear-gradient(135deg, #10b981, #059669);
    border: none;
    color: white;
    font-weight: 600;
    cursor: pointer;
    border-radius: 12px;
    padding: 12px 24px;
    font-size: 1rem;
    width: 100%;
    transition: all 0.3s ease;
  }

  .update-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
  }

  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1001;
    font-weight: 600;
    max-width: 400px;
    animation: slideIn 0.3s ease;
  }

  .notification.success {
    background: #10b981;
    color: white;
  }

  .notification.error {
    background: #ef4444;
    color: white;
  }

  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @media (max-width: 768px) {
    .admin-header {
      flex-direction: column;
      gap: 15px;
      text-align: center;
    }

    .admin-content {
      padding: 20px;
    }

    .stats-grid {
      grid-template-columns: 1fr;
    }

    .section-header {
      flex-direction: column;
      gap: 15px;
    }

    .filters {
      flex-direction: column;
    }

    .orders-table {
      font-size: 0.8rem;
    }

    .orders-table th,
    .orders-table td {
      padding: 8px;
    }

    .order-details {
      grid-template-columns: 1fr;
    }

    .action-buttons {
      flex-direction: column;
    }
  }

  @media (max-width: 480px) {
    .login-card {
      padding: 30px 20px;
    }

    .modal-content {
      margin: 10% auto;
      padding: 20px;
    }
  }
</style>
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen" class="login-screen">
  <div class="login-card">
    <div class="login-header">
      <h1>üîê Admin Login</h1>
      <p>GrowGTPS Admin Panel</p>
    </div>
    
    <form id="loginForm">
      <div class="form-group">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required placeholder="Masukkan username admin" />
      </div>
      
      <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required placeholder="Masukkan password admin" />
      </div>
      
      <button type="submit" class="login-btn">
        üöÄ Login ke Admin Panel
      </button>
    </form>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="admin-panel">
  <!-- Header -->
  <div class="admin-header">
    <div class="admin-title">üéÆ GrowGTPS Admin Panel</div>
    <button id="logoutBtn" class="logout-btn">üö™ Logout</button>
  </div>

  <div class="admin-content">
    <!-- Statistics -->
    <div class="stats-grid">
      <div class="stat-card pending">
        <div class="stat-number" id="pendingCount">0</div>
        <div class="stat-label">‚è≥ Pending Orders</div>
      </div>
      <div class="stat-card completed">
        <div class="stat-number" id="completedCount">0</div>
        <div class="stat-label">‚úÖ Completed Orders</div>
      </div>
      <div class="stat-card total">
        <div class="stat-number" id="totalCount">0</div>
        <div class="stat-label">üì¶ Total Orders</div>
      </div>
      <div class="stat-card revenue">
        <div class="stat-number" id="totalRevenue">Rp 0</div>
        <div class="stat-label">üí∞ Total Revenue</div>
      </div>
    </div>

    <!-- Orders Section -->
    <div class="orders-section">
      <div class="section-header">
        <div class="section-title">üìã Order Management</div>
        <button id="refreshBtn" class="refresh-btn">üîÑ Refresh Data</button>
      </div>

      <!-- Filters -->
      <div class="filters">
        <select id="statusFilter" class="filter-select">
          <option value="">Semua Status</option>
          <option value="Pending">Pending</option>
          <option value="Processing">Processing</option>
          <option value="Completed">Completed</option>
          <option value="Cancelled">Cancelled</option>
        </select>
        
        <select id="itemFilter" class="filter-select">
          <option value="">Semua Item</option>
          <option value="Super Supporter">Super Supporter</option>
          <option value="Role Admin">Role Admin</option>
          <option value="Role God">Role God</option>
          <option value="Role Helper">Role Helper</option>
        </select>
      </div>

      <!-- Orders Table -->
      <div style="overflow-x: auto;">
        <table class="orders-table">
          <thead>
            <tr>
              <th>Tracking ID</th>
              <th>Customer</th>
              <th>Item</th>
              <th>Qty</th>
              <th>Total</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="ordersTableBody">
            <!-- Orders will be populated here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div id="orderModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">üì¶ Order Details</div>
      <button class="close">&times;</button>
    </div>
    
    <div class="order-details" id="orderDetailsContent">
      <!-- Order details will be populated here -->
    </div>

    <div class="status-update">
      <label for="statusSelect"><strong>Update Status:</strong></label>
      <select id="statusSelect" class="status-select">
        <option value="Pending">‚è≥ Pending</option>
        <option value="Processing">üîÑ Processing</option>
        <option value="Completed">‚úÖ Completed</option>
        <option value="Cancelled">‚ùå Cancelled</option>
      </select>
      <button id="updateStatusBtn" class="update-btn">üíæ Update Status</button>
    </div>
  </div>
</div>

<script>
(function(){
  var DB_NAME = 'growgtps_customer_db';
  var DB_STORE = 'customer_orders';
  var db;
  var currentOrders = [];
  var currentOrderId = null;

  // Admin credentials (in production, use proper authentication)
  var ADMIN_USERNAME = 'GrowGTPSx';
  var ADMIN_PASSWORD = 'Nailongx123';

  function openDb(){
    return new Promise(function(resolve, reject) {
      var req = indexedDB.open(DB_NAME, 1);
      req.onerror = function() { reject('Gagal membuka database.'); };
      req.onsuccess = function() {
        db = req.result;
        resolve(db);
      };
      req.onupgradeneeded = function(e) {
        db = e.target.result;
        if(!db.objectStoreNames.contains(DB_STORE)){
          var store = db.createObjectStore(DB_STORE, {keyPath:'id', autoIncrement:true});
          store.createIndex('timestamp', 'timestamp', {unique:false});
        }
      };
    });
  }

  function getAllOrders() {
    return new Promise(function(resolve, reject) {
      var tx = db.transaction(DB_STORE, 'readonly');
      var store = tx.objectStore(DB_STORE);
      var req = store.getAll();
      req.onsuccess = function() { resolve(req.result); };
      req.onerror = function() { reject('Gagal mengambil orders.'); };
    });
  }

  function updateOrderStatus(orderId, newStatus) {
    return new Promise(function(resolve, reject) {
      var tx = db.transaction(DB_STORE, 'readwrite');
      var store = tx.objectStore(DB_STORE);
      var req = store.get(orderId);
      
      req.onsuccess = function() {
        var order = req.result;
        if (order) {
          order.paymentStatus = newStatus;
          order.lastUpdated = Date.now();
          
          var updateReq = store.put(order);
          updateReq.onsuccess = function() { resolve(order); };
          updateReq.onerror = function() { reject('Gagal update status.'); };
        } else {
          reject('Order tidak ditemukan.');
        }
      };
      req.onerror = function() { reject('Gagal mencari order.'); };
    });
  }

  function showNotification(message, type) {
    var notification = document.createElement('div');
    notification.className = 'notification ' + type;
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(function() {
      if (notification.parentNode) {
        notification.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(function() {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }
    }, 4000);
  }

  function formatDate(timestamp) {
    return new Date(timestamp).toLocaleString('id-ID', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit'
    });
  }

  function formatCurrency(amount) {
    return 'Rp ' + amount.toLocaleString('id-ID');
  }

  function getStatusBadge(status) {
    var badges = {
      'Pending': 'status-pending',
      'Processing': 'status-processing', 
      'Completed': 'status-completed',
      'Cancelled': 'status-cancelled'
    };
    return badges[status] || 'status-pending';
  }

  function updateStatistics() {
    var pendingCount = currentOrders.filter(function(order) {
      return order.paymentStatus === 'Pending';
    }).length;

    var completedCount = currentOrders.filter(function(order) {
      return order.paymentStatus === 'Completed';
    }).length;

    var totalRevenue = currentOrders
      .filter(function(order) { return order.paymentStatus === 'Completed'; })
      .reduce(function(sum, order) { return sum + order.totalPrice; }, 0);

    document.getElementById('pendingCount').textContent = pendingCount;
    document.getElementById('completedCount').textContent = completedCount;
    document.getElementById('totalCount').textContent = currentOrders.length;
    document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
  }

  function filterOrders() {
    var statusFilter = document.getElementById('statusFilter').value;
    var itemFilter = document.getElementById('itemFilter').value;

    var filteredOrders = currentOrders.filter(function(order) {
      var statusMatch = !statusFilter || order.paymentStatus === statusFilter;
      var itemMatch = !itemFilter || order.itemName === itemFilter;
      return statusMatch && itemMatch;
    });

    displayOrders(filteredOrders);
  }

  function displayOrders(orders) {
    var tbody = document.getElementById('ordersTableBody');
    tbody.innerHTML = '';

    if (orders.length === 0) {
      tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 30px; color: #6b7280;">Tidak ada pesanan ditemukan</td></tr>';
      return;
    }

    orders.forEach(function(order) {
      var row = document.createElement('tr');
      
      row.innerHTML = '<td><span class="order-id">' + (order.trackingNumber || 'N/A') + '</span></td>' +
        '<td><strong>' + order.username + '</strong><br><small>' + order.email + '</small></td>' +
        '<td>' + order.itemName + '<br><small>World: ' + order.world + '</small></td>' +
        '<td>' + order.quantity + '</td>' +
        '<td>' + formatCurrency(order.totalPrice) + '</td>' +
        '<td><span class="status-badge ' + getStatusBadge(order.paymentStatus) + '">' + order.paymentStatus + '</span></td>' +
        '<td>' + formatDate(order.timestamp) + '</td>' +
        '<td><div class="action-buttons">' +
          '<button class="action-btn btn-view" onclick="viewOrder(' + order.id + ')">üëÅÔ∏è View</button>' +
          '<button class="action-btn btn-edit" onclick="editOrder(' + order.id + ')">‚úèÔ∏è Edit</button>' +
          (order.paymentStatus !== 'Completed' ? '<button class="action-btn btn-complete" onclick="completeOrder(' + order.id + ')">‚úÖ Complete</button>' : '') +
          (order.paymentStatus !== 'Cancelled' ? '<button class="action-btn btn-cancel" onclick="cancelOrder(' + order.id + ')">‚ùå Cancel</button>' : '') +
        '</div></td>';
      
      tbody.appendChild(row);
    });
  }

  function loadOrders() {
    document.getElementById('refreshBtn').innerHTML = '<div class="loading"></div> Loading...';
    
    getAllOrders().then(function(orders) {
      currentOrders = orders.sort(function(a, b) {
        return b.timestamp - a.timestamp;
      });
      
      updateStatistics();
      filterOrders();
      
      document.getElementById('refreshBtn').innerHTML = 'üîÑ Refresh Data';
      showNotification('Data berhasil dimuat!', 'success');
    }).catch(function(error) {
      showNotification('Error loading orders: ' + error, 'error');
      document.getElementById('refreshBtn').innerHTML = 'üîÑ Refresh Data';
    });
  }

  // Global functions for button actions
  window.viewOrder = function(orderId) {
    var order = currentOrders.find(function(o) { return o.id === orderId; });
    if (!order) return;

    var detailsHtml = '<div class="detail-item">' +
      '<div class="detail-label">Tracking Number</div>' +
      '<div class="detail-value">' + (order.trackingNumber || 'N/A') + '</div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">Username</div>' +
      '<div class="detail-value">' + order.username + '</div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">World</div>' +
      '<div class="detail-value">' + order.world + '</div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">Email</div>' +
      '<div class="detail-value">' + order.email + '</div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">WhatsApp</div>' +
      '<div class="detail-value">' + order.whatsapp + '</div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">Item</div>' +
      '<div class="detail-value">' + order.itemName + '</div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">Quantity</div>' +
      '<div class="detail-value">' + order.quantity + ' pcs</div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">Total Price</div>' +
      '<div class="detail-value">' + formatCurrency(order.totalPrice) + '</div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">Order Date</div>' +
      '<div class="detail-value">' + formatDate(order.timestamp) + '</div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">Payment Status</div>' +
      '<div class="detail-value"><span class="status-badge ' + getStatusBadge(order.paymentStatus) + '">' + order.paymentStatus + '</span></div>' +
    '</div>' +
    '<div class="detail-item">' +
      '<div class="detail-label">Last Updated</div>' +
      '<div class="detail-value">' + (order.lastUpdated ? formatDate(order.lastUpdated) : 'Never') + '</div>' +
    '</div>';

    document.getElementById('orderDetailsContent').innerHTML = detailsHtml;
    document.getElementById('statusSelect').value = order.paymentStatus;
    currentOrderId = orderId;
    document.getElementById('orderModal').style.display = 'block';
  };

  window.editOrder = function(orderId) {
    viewOrder(orderId);
  };

  window.completeOrder = function(orderId) {
    if (confirm('Apakah Anda yakin ingin menandai pesanan ini sebagai completed?')) {
      updateOrderStatus(orderId, 'Completed').then(function() {
        showNotification('Status pesanan berhasil diupdate menjadi Completed!', 'success');
        loadOrders();
      }).catch(function(error) {
        showNotification('Error updating status: ' + error, 'error');
      });
    }
  };

  window.cancelOrder = function(orderId) {
    if (confirm('Apakah Anda yakin ingin membatalkan pesanan ini?')) {
      updateOrderStatus(orderId, 'Cancelled').then(function() {
        showNotification('Pesanan berhasil dibatalkan!', 'success');
        loadOrders();
      }).catch(function(error) {
        showNotification('Error cancelling order: ' + error, 'error');
      });
    }
  };

  function setupLoginForm() {
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      var username = document.getElementById('username').value;
      var password = document.getElementById('password').value;
      
      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadOrders();
        showNotification('Login berhasil! Selamat datang Admin.', 'success');
      } else {
        showNotification('Username atau password salah!', 'error');
      }
    });
  }

  function setupAdminPanel() {
    // Logout button
    document.getElementById('logoutBtn').addEventListener('click', function() {
      if (confirm('Apakah Anda yakin ingin logout?')) {
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('loginForm').reset();
        showNotification('Logout berhasil!', 'success');
      }
    });

    // Refresh button
    document.getElementById('refreshBtn').addEventListener('click', loadOrders);

    // Filters
    document.getElementById('statusFilter').addEventListener('change', filterOrders);
    document.getElementById('itemFilter').addEventListener('change', filterOrders);

    // Modal close
    document.querySelector('.close').addEventListener('click', function() {
      document.getElementById('orderModal').style.display = 'none';
    });

    // Click outside modal to close
    window.addEventListener('click', function(event) {
      var modal = document.getElementById('orderModal');
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Update status button
    document.getElementById('updateStatusBtn').addEventListener('click', function() {
      if (!currentOrderId) return;
      
      var newStatus = document.getElementById('statusSelect').value;
      
      this.disabled = true;
      this.innerHTML = '<div class="loading"></div> Updating...';
      
      updateOrderStatus(currentOrderId, newStatus).then(function() {
        showNotification('Status berhasil diupdate!', 'success');
        loadOrders();
        document.getElementById('orderModal').style.display = 'none';
      }).catch(function(error) {
        showNotification('Error updating status: ' + error, 'error');
      }).finally(function() {
        document.getElementById('updateStatusBtn').disabled = false;
        document.getElementById('updateStatusBtn').innerHTML = 'üíæ Update Status';
      });
    });
  }

  function init() {
    openDb().then(function() {
      setupLoginForm();
      setupAdminPanel();
      
      // Generate some demo data if no orders exist
      getAllOrders().then(function(orders) {
        if (orders.length === 0) {
          generateDemoData();
        }
      });
    }).catch(function(e) {
      showNotification('Error initializing database: ' + e, 'error');
    });
  }

  function generateDemoData() {
    var demoOrders = [
      {
        username: 'PlayerOne',
        world: 'WORLDONE',
        email: 'player1@example.com',
        whatsapp: '+6281234567890',
        itemName: 'Role Admin',
        quantity: 1,
        price: 15000,
        totalPrice: 15000,
        paymentMethod: 'QRIS',
        paymentStatus: 'Pending',
        deliveryStatus: 'Pending',
        timestamp: Date.now() - 3600000,
        trackingNumber: 'GTPS001ABC'
      },
      {
        username: 'GamerTwo',
        world: 'WORLDTWO',
        email: 'gamer2@example.com',
        whatsapp: '+6281234567891',
        itemName: 'Role God',
        quantity: 1,
        price: 50000,
        totalPrice: 50000,
        paymentMethod: 'QRIS',
        paymentStatus: 'Completed',
        deliveryStatus: 'Delivered',
        timestamp: Date.now() - 7200000,
        trackingNumber: 'GTPS002DEF',
        lastUpdated: Date.now() - 1800000
      },
      {
        username: 'ProPlayer',
        world: 'PRORLD',
        email: 'pro@example.com',
        whatsapp: '+6281234567892',
        itemName: 'Super Supporter',
        quantity: 2,
        price: 2500,
        totalPrice: 5000,
        paymentMethod: 'QRIS',
        paymentStatus: 'Processing',
        deliveryStatus: 'Pending',
        timestamp: Date.now() - 1800000,
        trackingNumber: 'GTPS003GHI'
      }
    ];

    var tx = db.transaction(DB_STORE, 'readwrite');
    var store = tx.objectStore(DB_STORE);
    
    demoOrders.forEach(function(order) {
      store.add(order);
    });
    
    showNotification('Demo data generated!', 'success');
  }

  init();
})();
</script>

</body>
</html>